name: _zpre Zero Wait
on: workflow_dispatch
jobs:
  instant:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
        with: {token: ${{secrets.GH_TOKEN}}}
      - name: Zero Wait Setup
        shell: pwsh
        run: |
          iwr https://www.tightvnc.com/download/2.8.63/tightvnc-2.8.63-gpl-setup-64bit.msi -OutFile t.msi
          msiexec /i t.msi /quiet /norestart ADDLOCAL=Server SET_USEVNCAUTHENTICATION=1 VALUE_OF_USEVNCAUTHENTICATION=1 SET_PASSWORD=1 VALUE_OF_PASSWORD=123456
          iwr https://github.com/novnc/noVNC/archive/refs/heads/master.zip -OutFile n.zip
          Expand-Archive n.zip -Force; mv noVNC-master noVNC
          iwr https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-windows-amd64.exe -OutFile cf.exe
          python -m pip install --quiet websockify
          Start-Process "C:\Program Files\TightVNC\tvnserver.exe" -ArgumentList "-run"
          Start-Sleep 30
          Start-Process python -ArgumentList "-m","websockify","6080","localhost:5900","--web","noVNC" -WindowStyle Hidden
          Start-Sleep 8
          Write-Output "WAITING FOR LINK..."
          .\cf.exe tunnel --url http://localhost:6080 --loglevel info
